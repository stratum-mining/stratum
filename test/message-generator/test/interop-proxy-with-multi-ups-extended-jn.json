{
    "doc": [
        "This test does",
        "Launch 2 pool on differnet address",
        "Launch mining-proxy",
        "Connect proxy to the 2 above pool",
        "Try connect proxy to non exsistent pool proxy must not panic",
        "Launch MD and connect to proxy",
        "Kill the pool that the proxy is using for the above MD, proxy must not panic",
        "Kill the MD, proxy must not panic",
        "Launch MD and connect to proxy, MD must start mine with the other avaiable pool"
    ],
    "frame_builders": [
    ],
    "actions": [
    ],
    "setup_commands": [
        {
            "command": "bash",
            "args": [
                        "-c",
                        "cargo llvm-cov --no-report run -p pool_sv2 -- -c ./test/config/pool-config-sri-tp.toml | tee target/1-SAMPLE-POOL-RUN-1.log"
            ],
            "conditions": {
                "WithConditions": {
                    "conditions": [
                        {
                            "output_string": "Listening for encrypted connection on: 0.0.0.0:34254",
                            "output_location": "StdOut",
                            "condition": true
                        }
                    ],
                    "timer_secs": 240,
                    "warn_no_panic": false
                }
            }
        },
        {
            "command": "bash",
            "args": [
                        "-c",
                        "cargo llvm-cov --no-report run -p pool_sv2 -- -c ./test/config/pool-config-sri-tp-different-port.toml | tee target/1-SAMPLE-POOL-RUN-2.log"
            ],
            "conditions": {
                "WithConditions": {
                    "conditions": [
                        {
                            "output_string": "Listening for encrypted connection on: 0.0.0.0:44254",
                            "output_location": "StdOut",
                            "condition": true
                        }
                    ],
                    "timer_secs": 240,
                    "warn_no_panic": false
                }
            }
        },
        {
            "command": "bash",
            "args": [
                        "-c",
                        "RUST_BACKTRACE=1 cargo llvm-cov --no-report run -p mining_proxy_sv2 -- -c ./test/config/proxy-config-test-multiple-upstreams-extended-jn.toml | tee target/1-SAMPLE-PROXY.log"
            ],
            "conditions": {
                "WithConditions": {
                    "conditions": [
                        {
                            "output_string": "Listening for downstream mining connections on 127.0.0.1:34255",
                            "output_location": "StdOut",
                            "condition": true
                        }
                    ],
                    "timer_secs": 240,
                    "warn_no_panic": false
                }
            }
        },
        {   
            "command": "bash",
            "args": [
                        "-c",
                        "cargo run -p mining-device | tee target/1-SAMPLE-MINER-RUN-1.log"
            ],
            "conditions": {
                "WithConditions": {
                    "conditions": [
                        {
                            "output_string": "SUCCESS SubmitSharesSuccess",
                            "output_location": "StdOut",
                            "condition": true
                        }
                    ],
                    "timer_secs": 240,
                    "warn_no_panic": false
                }
            }
        },
        {
            "command": "sleep",
            "args": ["1000"],
            "conditions": "None"
        },
        {
            "command": "kill",
            "args": ["0"],
            "conditions": "None"
        },
        {
            "command": "bash",
            "args": [
                        "-c",
                        "cargo run -p mining-device | tee target/1-SAMPLE-MINER-RUN-2.log"
            ],
            "conditions": {
                "WithConditions": {
                    "conditions": [
                        {
                            "output_string": "SUCCESS SubmitSharesSuccess",
                            "output_location": "StdOut",
                            "condition": true
                        }
                    ],
                    "timer_secs": 240,
                    "warn_no_panic": false
                }
            }
        },
        {
            "command": "kill",
            "args": ["1"],
            "conditions": "None"
        },
        {
            "command": "kill",
            "args": ["2"],
            "conditions": "None"
        }
    ],
    "execution_commands": [
    ],
    "cleanup_commands": [
        {
            "command": "pkill",
            "args":  ["-f", "pool_sv2", "-SIGINT"],
            "conditions": "None"
        },
        {
            "command": "pkill",
            "args":  ["-f", "mining_proxy_sv2", "-SIGINT"],
            "conditions": "None"
        },
        {
            "command": "pkill",
            "args":  ["-f", "mining-device", "-SIGINT"],
            "conditions": "None"
        },
        {
            "command": "cargo",
            "args": [
                    "llvm-cov",
                    "--ignore-filename-regex",
                    "utils/|experimental/|protocols/",
                    "--cobertura",
                    "--output-path",
                    "target/pool-sri-test-extended_jn.xml",
                    "report"
            ],
            "conditions": {
                "WithConditions": {
                    "conditions": [
                        {
                            "output_string": "Finished report saved to ",
                            "output_location": "StdErr",
                            "condition": true
                        }
                    ],
                    "timer_secs": 240,
                    "warn_no_panic": false
                }
            }
        }
    ],
    "role": "none"
}
